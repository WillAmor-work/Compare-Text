
 /******************************************************************************

Modification History:

 2018-06-06 CY   1: Clear tables JOURNAL, CASEIMAGE, NAMEIMAGE, IMAGEDETAIL and IMAGE
 2016-02-24 CY      Created

******************************************************************************/

--select * from cases 
-- LOOKS LIKE THIS WAS CREATED AT RELEASE 7.1
-- NEED TO SEE WHAT ADDITIONAL TABLES HAVE BEEN ADDED SINCE THEN THRU TO 10.1.2


-- Also changed 'DELETE FROM' to 'TRUNCATE TABLE' which improved performance out of sight. Was taking hours previously


-- Case Related
-- ------------

print '*** ACTIVITY ***'
delete from ACTIVITY
where (CASEID is not null and CASEID < 500)
go
print '*** ACTIVITYATTACHMENT ***'
delete AA
from ACTIVITYATTACHMENT AA
where AA.ACTIVITYNO not in (select A.ACTIVITYNO from ACTIVITY A)
go
print '*** ACTIVITYHISTORY ***'
delete from ACTIVITYHISTORY where CASEID < 500
go
print '*** ACTIVITYREQUEST ***'
delete from ACTIVITYREQUEST where CASEID < 500
go
print '*** ALERT ***'
delete from ALERT where CASEID < 500
go
print '*** CASECHECKLIST ***'
delete from CASECHECKLIST where CASEID < 500
go
print '*** CASEEVENT ***'
delete from CASEEVENT where CASEID < 500
go
--1:->
print '*** CASEIMAGE ***'
delete from CASEIMAGE where CASEID < 500
go
--1:-<
print '*** CASEINDEXES ***'
delete from CASEINDEXES where CASEID < 500
go
print '*** CASEINSTRUCTIONS ***'
delete from CASEINSTRUCTIONS where CASEID < 500
go
print '*** CASEINSTRUCTIONSRECALC ***'
delete from CASEINSTRUCTIONSRECALC where CASEID < 500
go
print '*** CASELOCATION ***'
delete from CASELOCATION where CASEID < 500
go
print '*** CASENAME ***'
delete from CASENAME where CASEID < 500
go
print '*** CASES ***'
delete from CASES where CASEID < 500
go
print '*** CASETEXT ***'
delete from CASETEXT where CASEID < 500
go
print '*** CASEWORDS ***'
delete from CASEWORDS where CASEID < 500
go
print '*** CLASSFIRSTUSE ***'
delete from CLASSFIRSTUSE where CASEID < 500
go
print '*** DIARY ***'
delete from DIARY where CASEID < 500
go
print '*** EMPLOYEEREMINDER ***'
delete from EMPLOYEEREMINDER where CASEID < 500
go
print '*** FILEPART ***'
delete from FILEPART where CASEID < 500
go
--1:->
print '*** JOURNAL ***'
delete from JOURNAL where CASEID is not null
go
--1:-<
print '*** NAMEINSTRUCTIONS ***'
delete from NAMEINSTRUCTIONS where CASEID < 500
go
print '*** OFFICIALNUMBERS ***'
delete from OFFICIALNUMBERS where CASEID < 500
go
print '*** OPENACTION ***'
delete from OPENACTION where CASEID < 500
go
print '*** OPENITEM ***'
delete from OPENITEM where MAINCASEID < 500
go
print '*** POLICING ***'
delete from POLICING where SYSGENERATEDFLAG = 1
go
print '*** POLICINGERRORS ***'
delete from POLICINGERRORS where CASEID < 500
go
print '*** PROPERTY ***'
delete from PROPERTY where CASEID < 500
go
print '*** RELATEDCASE ***'
delete from RELATEDCASE where CASEID < 500
go
print '*** RELATEDCASE ***'
delete from RELATEDCASE where relatedCASEID < 500
go


print '*** OPENACTION ***'
delete from OPENACTION where ACTION = 'CD'
go

print '*** ADDRESS ***'
delete a
from ADDRESS a
where ADDRESSCODE < 500
--join NAMEADDRESS na on a.ADDRESSCODE = na.ADDRESSCODE and na.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** TELECOMMUNICATION ***'
delete t
from TELECOMMUNICATION t
where TELECODE < 500
--join NAMETELECOM nt on t.TELECODE = nt.TELECODE and nt.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go


print '*** ACTIVITY ***'
delete A
from ACTIVITY A
where A.NAMENO is not null
and A.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** ACTIVITYATTACHMENT ***'
delete AA
from ACTIVITYATTACHMENT AA
where AA.ACTIVITYNO not in (select A.ACTIVITYNO from ACTIVITY A)
go
print '*** ACTIVITYREQUEST ***'
delete from ACTIVITYREQUEST where ACTIVITYREQUEST.DEBTOR in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** ASSOCIATEDNAME ***'
delete from ASSOCIATEDNAME where ASSOCIATEDNAME.RELATEDNAME in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** ASSOCIATEDNAME ***'
delete from ASSOCIATEDNAME where ASSOCIATEDNAME.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** BANKACCOUNT ***'
delete from BANKACCOUNT where BANKACCOUNT.ACCOUNTOWNER in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** BANKACCOUNT ***'
delete from BANKACCOUNT where BANKACCOUNT.BANKNAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** CASENAME ***'
delete from CASENAME where CASENAME.INHERITEDNAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** CASENAME ***'
delete from CASENAME where CASENAME.CORRESPONDNAME in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** CASENAME ***'
delete from CASENAME where CASENAME.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
--print '*** CASHITEM ***'
--delete from CASHITEM where CASHITEM.ACCTNAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
--go
print '*** CREDITOR ***'
delete from CREDITOR where CREDITOR.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** DIARY ***'
delete from DIARY where DIARY.EMPLOYEENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** DISCOUNT ***'
delete from DISCOUNT where DISCOUNT.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
--print '*** EMPLOYEE ***'
--delete from EMPLOYEE where EMPLOYEE.EMPLOYEENO in (select n.NAMENO from NAME n where n.NAMENO < 500)
--go
print '*** EMPLOYEEREMINDER ***'
delete from EMPLOYEEREMINDER where EMPLOYEEREMINDER.EMPLOYEENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** FEESCALCULATION ***'
delete from FEESCALCULATION where FEESCALCULATION.DEBTOR in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** FEESCALCULATION ***'
delete from FEESCALCULATION where FEESCALCULATION.SERVEMPLOYEENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** FEESCALCULATION ***'
delete from FEESCALCULATION where FEESCALCULATION.DISBEMPLOYEENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** FILESIN ***'
delete from FILESIN where FILESIN.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** INDIVIDUAL ***'
delete from INDIVIDUAL where INDIVIDUAL.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** IPNAME ***'
delete from IPNAME where IPNAME.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** NAMEADDRESS ***'
delete from NAMEADDRESS where NAMEADDRESS.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
--print '*** NAMEADDRESSSNAP ***'
--delete from NAMEADDRESSSNAP where NAMEADDRESSSNAP.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
--go
--print '*** NAMEADDRESSSNAP ***'
--delete from NAMEADDRESSSNAP where NAMEADDRESSSNAP.ATTNNAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
--go
print '*** NAMEALIAS ***'
delete from NAMEALIAS where NAMEALIAS.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** NAMEEXEMPTCHARGES ***'
delete from NAMEEXEMPTCHARGES where NAMEEXEMPTCHARGES.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
--1:->
print '*** NAMEIMAGE ***'
delete from NAMEIMAGE where NAMEIMAGE.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
--1:-<
print '*** NAMEINSTRUCTIONS ***'
delete from NAMEINSTRUCTIONS where NAMEINSTRUCTIONS.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** NAMETELECOM ***'
delete from NAMETELECOM where NAMETELECOM.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** NAMETEXT ***'
delete from NAMETEXT where NAMETEXT.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** NAMETYPECLASSIFICATION ***'
delete from NAMETYPECLASSIFICATION where NAMETYPECLASSIFICATION.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** ORGANISATION ***'
delete from ORGANISATION where ORGANISATION.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
print '*** SPECIALNAME ***'
delete from SPECIALNAME where SPECIALNAME.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3)
go
--print '*** TIMECOSTING ***'
--delete from TIMECOSTING
--where (TIMECOSTING.EMPLOYEENO is not null and TIMECOSTING.EMPLOYEENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3))
--go



-- Staff

print '*** ADDRESS ***'
delete a
from ADDRESS a
join NAMEADDRESS na on a.ADDRESSCODE = na.ADDRESSCODE and na.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** TELECOMMUNICATION ***'
delete t
from TELECOMMUNICATION t
join NAMETELECOM nt on t.TELECODE = nt.TELECODE and nt.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go


print '*** ACTIVITY ***'
delete A
from ACTIVITY A
where A.NAMENO is not null
and A.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** ACTIVITYATTACHMENT ***'
delete AA
from ACTIVITYATTACHMENT AA
where AA.ACTIVITYNO not in (select A.ACTIVITYNO from ACTIVITY A)
go
print '*** ACTIVITYREQUEST ***'
delete from ACTIVITYREQUEST where ACTIVITYREQUEST.DEBTOR in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** ASSOCIATEDNAME ***'
delete from ASSOCIATEDNAME where ASSOCIATEDNAME.RELATEDNAME in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** ASSOCIATEDNAME ***'
delete from ASSOCIATEDNAME where ASSOCIATEDNAME.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** BANKACCOUNT ***'
delete from BANKACCOUNT where BANKACCOUNT.ACCOUNTOWNER in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** BANKACCOUNT ***'
delete from BANKACCOUNT where BANKACCOUNT.BANKNAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** CASENAME ***'
delete from CASENAME where CASENAME.INHERITEDNAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** CASENAME ***'
delete from CASENAME where CASENAME.CORRESPONDNAME in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** CASENAME ***'
delete from CASENAME where CASENAME.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
--print '*** CASHITEM ***'
--delete from CASHITEM where CASHITEM.ACCTNAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
--go
print '*** CREDITOR ***'
delete from CREDITOR where CREDITOR.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** DIARY ***'
delete from DIARY where DIARY.EMPLOYEENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** DISCOUNT ***'
delete from DISCOUNT where DISCOUNT.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** EMPLOYEE ***'
delete from EMPLOYEE where EMPLOYEE.EMPLOYEENO in (select n.NAMENO from NAME n where n.NAMENO < 500)
go
print '*** EMPLOYEEREMINDER ***'
delete from EMPLOYEEREMINDER where EMPLOYEEREMINDER.EMPLOYEENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** FEESCALCULATION ***'
delete from FEESCALCULATION where FEESCALCULATION.DEBTOR in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** FEESCALCULATION ***'
delete from FEESCALCULATION where FEESCALCULATION.SERVEMPLOYEENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** FEESCALCULATION ***'
delete from FEESCALCULATION where FEESCALCULATION.DISBEMPLOYEENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** FILESIN ***'
delete from FILESIN where FILESIN.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** INDIVIDUAL ***'
delete from INDIVIDUAL where INDIVIDUAL.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** IPNAME ***'
delete from IPNAME where IPNAME.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** NAMEADDRESS ***'
delete from NAMEADDRESS where NAMEADDRESS.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** NAMEALIAS ***'
delete from NAMEALIAS where NAMEALIAS.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** NAMEEXEMPTCHARGES ***'
delete from NAMEEXEMPTCHARGES where NAMEEXEMPTCHARGES.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
--1:->
print '*** NAMEIMAGE ***'
delete from NAMEIMAGE where NAMEIMAGE.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
--1:-<
print '*** NAMEINSTRUCTIONS ***'
delete from NAMEINSTRUCTIONS where NAMEINSTRUCTIONS.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** NAMETELECOM ***'
delete from NAMETELECOM where NAMETELECOM.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** NAMETEXT ***'
delete from NAMETEXT where NAMETEXT.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** NAMETYPECLASSIFICATION ***'
delete from NAMETYPECLASSIFICATION where NAMETYPECLASSIFICATION.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** ORGANISATION ***'
delete from ORGANISATION where ORGANISATION.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** SPECIALNAME ***'
delete from SPECIALNAME where SPECIALNAME.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go
print '*** TIMECOSTING ***'
delete from TIMECOSTING
where (TIMECOSTING.EMPLOYEENO is not null and TIMECOSTING.EMPLOYEENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3))
go

-- Accounting
-- ----------

--
-- WIP
--
print '*** EXPENSEIMPORT ***'
truncate table EXPENSEIMPORT
go
print '*** BILLEDITEM ***'
truncate table BILLEDITEM
go
print '*** DIARY ***'
truncate table DIARY
go
print '*** WORKHISTORY ***'
truncate table WORKHISTORY
go
print '*** WORKINPROGRESS ***'
truncate table WORKINPROGRESS
go
print '*** TRANSADJUSTMENT ***'
truncate table TRANSADJUSTMENT
go
--
-- BILLING AND AR
--
print '*** BILLLINE ***'
truncate table BILLLINE
go
print '*** TAXHISTORY ***'
truncate table TAXHISTORY
go
print '*** DEBTORHISTORYCASE ***'
truncate table DEBTORHISTORYCASE
go
print '*** DEBTORHISTORY ***'
truncate table DEBTORHISTORY
go
print '*** OPENITEMTAX ***'
truncate table OPENITEMTAX
go
print '*** OPENITEMCASE ***'
truncate table OPENITEMCASE
go
print '*** OPENITEM ***'
truncate table OPENITEM
go
print '*** NAMEADDRESSSNAP ***'
truncate table NAMEADDRESSSNAP
go
--
-- AP
--
print '*** PAYMENTPLANDETAIL ***'
truncate table PAYMENTPLANDETAIL
go
print '*** PAYMENTPLAN ***'
truncate table PAYMENTPLAN
go
print '*** TAXPAIDHISTORY ***'
truncate table TAXPAIDHISTORY
go
print '*** TAXPAIDITEM ***'
truncate table TAXPAIDITEM
go
print '*** CREDITORHISTORY ***'
truncate table CREDITORHISTORY
go
print '*** CREDITORITEM ***'
truncate table CREDITORITEM
go
--
-- FEES LIST
--
print '*** FEELISTCASE ***'
truncate table FEELISTCASE
go
print '*** FEELIST ***'
truncate table FEELIST
go
--
-- CASHBOOK
--
print '*** CHEQUEREGISTER ***'
truncate table CHEQUEREGISTER
go
print '*** CASHHISTORY ***'
truncate table CASHHISTORY
go
print '*** CASHITEM ***'
truncate table CASHITEM
go
print '*** BANKHISTORY ***'
truncate table BANKHISTORY
go
--
-- TRUST
--
print '*** TRUSTHISTORY ***'
truncate table TRUSTHISTORY
go
print '*** TRUSTITEM ***'
truncate table TRUSTITEM
go
--
-- FI AND GL
--
print '*** GLJOURNALLINE ***'
truncate table GLJOURNALLINE
go
print '*** GLJOURNALLINEEXT ***'
truncate table GLJOURNALLINEEXT
go
print '*** GLJOURNAL ***'
truncate table GLJOURNAL
go
print '*** LEDGERJOURNALLINEBALANCE ***'
truncate table LEDGERJOURNALLINEBALANCE
go
print '*** LEDGERJOURNALLINE ***'
truncate table LEDGERJOURNALLINE
go
print '*** LEDGERJOURNAL ***'
truncate table LEDGERJOURNAL
go
print '*** BUDGET ***'
truncate table BUDGET
go

--
-- TOTALS
--
print '*** TRANSACTIONHEADER ***'
truncate table TRANSACTIONHEADER
go
print '*** CONTROLTOTAL ***'
truncate table CONTROLTOTAL
go
print '*** TRUSTACCOUNT ***'
truncate table TRUSTACCOUNT
go
print '*** ACCOUNT ***'
--update ACCOUNT
--set BALANCE = 0.00, CRBALANCE = 0.00
--go
truncate table ACCOUNT
go


print '*** BANKACCOUNT ***'
update BANKACCOUNT
set ACCOUNTBALANCE = 0.00,
    LOCALBALANCE = 0.00
go



-- General
-- -------

print '*** CPAUPDATE ***'
truncate table CPAUPDATE
go

print '*** EDETRANSACTIONHEADER ***'
truncate table EDETRANSACTIONHEADER
go

print '*** IDENTITYINDEX ***'
truncate table IDENTITYINDEX	-- used by Web to store list of recent cases queried
go

--1:->
print '*** IMAGE ***'
truncate table IMAGE
go

print '*** IMAGEDETAIL ***'
truncate table IMAGEDETAIL
go
--1:-<

print '*** SESSION ***'
truncate table SESSION
go

print '*** POLICINGLOG ***'
truncate table POLICINGLOG
go

print '*** TABLEATTRIBUTES ***'
delete from TABLEATTRIBUTES
where (PARENTTABLE = 'CASES' and case when isnumeric(GENERICKEY) = 1 then convert(int,GENERICKEY) else null end > 0)
or (PARENTTABLE = 'NAME' and case when isnumeric(GENERICKEY) = 1 then convert(int,GENERICKEY) else null end in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO > 504)) and n.usedasflag <> 3))
go

print '*** TRANSACTIONINFO ***'
delete from TRANSACTIONINFO where TRANSACTIONDATE > '2008-01-01'	-- Date of starting database
go

print '*** TABLECODES ***'
delete from TABLECODES
where TABLETYPE = 10
and TABLECODE > 101146 -- Last internal code value for 'TABLECODE' from starting database
go

-- Needs to be done last as deletion of names data from other tables is dependant on the existence of row in NAME table

print '*** NAME ***'
delete from NAME where NAME.NAMENO in (select n.NAMENO from NAME n where ((n.NAMENO < 500) or (n.NAMENO between 526 and 536) or (n.NAMENO between 541 and 544)or (n.NAMENO between 554 and 557) or (n.NAMENO = 561)))
go
print '*** NAME ***'
delete from NAME where NAME.NAMENO in (select n.NAMENO from NAME n where n.NAMENO < 500 and n.usedasflag = 3)
go

--not working correctly
--print '*** NAME  remove IPR test staff names ***'
--delete from NAME where nameno > 0 and USEDASFLAG = 3 and nameno > 545 and firstname is not null
--go

-- Drop conversion staging tables
/*
 DROP TABLE Conv_ACTIVITYATTACHMENT
GO
 DROP TABLE Conv_ACTIVITYATTACHMENT_Fail
GO
 DROP TABLE Conv_ACTIVITYATTACHMENT_WithNo
GO
 DROP TABLE Conv_ACTIVITYHISTORY
GO
 DROP TABLE Conv_ADDRESS
GO
 DROP TABLE Conv_ALERT
GO
 DROP TABLE Conv_ALERT_Fail
GO
 DROP TABLE Conv_Alert_Resequence
GO
 DROP TABLE Conv_Alert_Resequence_MINID
GO
 DROP TABLE Conv_ASSOCIATEDNAME
GO
 DROP TABLE Conv_ASSOCIATEDNAME_Fail
GO
 DROP TABLE Conv_CASEEVENT
GO
 DROP TABLE Conv_CASEEVENT_Fail
GO
 DROP TABLE Conv_CaseEvent_Resequence
GO
 DROP TABLE Conv_CaseEvent_Resequence_MINID
GO
 DROP TABLE Conv_CASEIMAGE
GO
 DROP TABLE Conv_CASEIMAGE_Fail
GO
 DROP TABLE CONV_CASELOCATION
GO
 DROP TABLE Conv_CASENAME
GO
 DROP TABLE Conv_CASENAME_Fail
GO
 DROP TABLE Conv_CaseName_Resequence
GO
 DROP TABLE Conv_CaseName_Resequence_MINID
GO
 DROP TABLE Conv_CASENAME_WithNo
GO
 DROP TABLE Conv_CASENAME_WithNo_MINID
GO
 DROP TABLE Conv_CASES
GO
 DROP TABLE Conv_CASES_Fail
GO
 DROP TABLE Conv_CASES_WithNo
GO
 DROP TABLE Conv_CASETEXT
GO
 DROP TABLE Conv_CASETEXT_Fail
GO
 DROP TABLE Conv_CaseText_Resequence
GO
 DROP TABLE Conv_CaseText_Resequence_MINID
GO
 DROP TABLE Conv_CLIENT
GO
 DROP TABLE Conv_CLIENTDISCOUNT
GO
 DROP TABLE Conv_FailReason
GO
 DROP TABLE Conv_File_CommandLineOutput
GO
 DROP TABLE Conv_File_CompressQueue
GO
 DROP TABLE Conv_File_DatabaseRestoreFileList
GO
 DROP TABLE Conv_File_DatabaseRestoreQueue
GO
 DROP TABLE Conv_File_FolderContents
GO
 DROP TABLE Conv_File_SysFiles
GO
 DROP TABLE Conv_FILESIN
GO
 DROP TABLE Conv_FILESIN_Fail
GO
 DROP TABLE Conv_IMAGE
GO
 DROP TABLE Conv_IMAGE_Fail
GO
 DROP TABLE Conv_JOURNAL
GO
 DROP TABLE Conv_JOURNAL_Fail
GO
 DROP TABLE Conv_LEGACYCASEEVENT
GO
 DROP TABLE Conv_LEGACYCASEEVENTFAIL
GO
 DROP TABLE Conv_LEGACYEVENTWITHNO
GO
 DROP TABLE Conv_Log_ActionDetail
GO
 DROP TABLE Conv_Map_Country
GO
 DROP TABLE Conv_Map_NameEntityType
GO
 DROP TABLE Conv_Map_NameTitleGender
GO
 DROP TABLE Conv_NAME
GO
 DROP TABLE Conv_NAME_Fail
GO
 DROP TABLE Conv_NAME_WithNo
GO
 DROP TABLE Conv_NAMEACTIVITYATTACHMENT
GO
 DROP TABLE Conv_NAMEADDRESS_WithNo
GO
 DROP TABLE Conv_NAMEALIAS
GO
 DROP TABLE Conv_NAMEALIAS_Fail
GO
 DROP TABLE Conv_NAMEIMAGE
GO
 DROP TABLE Conv_NAMEIMAGE_Fail
GO
 DROP TABLE Conv_NAMETELECOM_WithNo
GO
 DROP TABLE Conv_NAMETEXT
GO
 DROP TABLE Conv_NAMETEXT_Fail
GO
 DROP TABLE Conv_OFFICIALNUMBERS
GO
 DROP TABLE Conv_OFFICIALNUMBERS_Fail
GO
 DROP TABLE Conv_Police_CaseList
GO
 DROP TABLE Conv_Police_ParallelJobStep
GO
 DROP TABLE Conv_RELATEDCASE
GO
 DROP TABLE Conv_RELATEDCASE_Fail
GO
 DROP TABLE Conv_RelatedCase_Resequence
GO
 DROP TABLE Conv_RelatedCase_Resequence_MINID
GO
 DROP TABLE Conv_ScriptsToRun
GO
 DROP TABLE Conv_Setting
GO
 DROP TABLE Conv_Setting_OverviewOpenActionsToOpen
GO
 DROP TABLE Conv_Stats_BatchBreakdown
GO
 DROP TABLE Conv_SUPPLIER
GO
 DROP TABLE Conv_TABLEATTRIBUTES
GO
 DROP TABLE Conv_TABLEATTRIBUTES_Fail
GO
 DROP TABLE Conv_TextFileContents
GO
*/

/* Remove all iLOG info */

declare @temp table (id int identity, [name] nvarchar(50))

insert into @temp
select name from sys.tables
where name like '%ilog'
order by name

declare @i int = 1, @max int, @table nvarchar(50), @sql nvarchar(4000)

select @max = max(id) from @temp

while @i <= @max
Begin
	select @table = [name] 
	from @temp
	where id = @i

	set @sql = N'
	If (select count(*) from '+@table+')>0
	Begin
		truncate table '+@table+'
	End
	'
	exec sp_executesql @sql

	set @i+=1
End

